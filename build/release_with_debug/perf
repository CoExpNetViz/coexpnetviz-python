#!/bin/sh
set -e

finish() {
    trap - 2
    perf report
}

. ../$1_command.sh

trap finish 2
if true; then
    perf record --call-graph dwarf -F99 ${command[@]} &> perf.log &
    pid=$!
    sleep 60
    kill $pid
else
    perf record --call-graph dwarf -F9 ${command[@]}
fi
finish
